<!-- HTML header for doxygen 1.9.6-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="$langISO">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HiRep: Coding Conventions</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init();
    DoxygenAwesomeInteractiveToc.init();
</script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<!-- <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
  jax: ["input/TeX","output/SVG"],
});
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "all" } },
  "HTML-CSS": { linebreaks: { automatic: true } },
  SVG: { linebreaks: { automatic: true } }
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
 -->
<script>
  window.MathJax = {
    tex: {
      tags: "all",
      packages: ['base', 'ams']
    },
    options: {
      ignoreHtmlClass: 'tex2jax_ignore',
      processHtmlClass: 'tex2jax_process',
      lazyMargin: '1200px',
    },
    loader: {load: ['ui/lazy']}
  };
</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
<!-- $darkmode -->
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
  <!-- https://tholman.com/github-corners/ -->
<a href="https://github.com/claudiopica/HiRep" class="github-corner" title="View project on GitHub" target="_blank">
  <svg viewBox="0 0 250 250" width="40" height="40" style="position: absolute; top: 0; border: 0; right: 0; z-index: 99;" aria-hidden="true">
  <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">HiRep<span id="projectnumber">&#160;0.1</span>
   </div>
   <!-- BEGIN PROJECT_BRIEF<div id="projectbrief">HiRep</div>END PROJECT_BRIEF -->
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d4/d4d/md_developer_guide_coding_conventions.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Coding Conventions </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md65">Function Names</a></li>
<li class="level1"><a href="#autotoc_md66">Error Handling</a><ul><li class="level2"><a href="#autotoc_md67">Usage of Macros</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p ><a class="anchor" id="coding_conventions"></a> </p>
<h1><a class="anchor" id="autotoc_md65"></a>
Function Names</h1>
<p >Functions in <code>HiRep</code> need to be implemented for different field or site types, different representations, single and double precision as well as to run on CPU or with GPU acceleration. In order to avoid confusion, functions are named in a coherent matter using the following structure</p>
<div class="image">
<img src="../../naming_1.png" alt="" width="300px"/>
<div class="caption">
Naming Conventions Example</div></div>
 <p >Here, part (1) is the name of the operation performed. Following this is the type of the field structure or site elementary structure that the operation is performed on. (3) then denotes the representation of the structure. <code>f</code> denotes the fundamental representation. (4) indicates, whether the function assume single or double precision. The suffix <code>flt</code> (corresponding to <code>float</code>) denotes single precision , while the omission of this suffix denotes double precision. Finally, the suffixes <code>cpu</code> and <code>gpu</code> distinguish, whether this function operates on an object in the memory of either the host/CPU or device/GPU.</p>
<h1><a class="anchor" id="autotoc_md66"></a>
Error Handling</h1>
<p >Some standard error handling is implemented in <code><a class="el" href="../../da/d41/error_8h_source.html">error.h</a></code>, that prints generic information about what went wrong. CUDA Runtime checking should be done either directly over <code><a class="el" href="../../d2/d41/error__gpu_8h.html#a51204a79b758abb43c371167a2adc91b" title="Check CUDA call and log error message on failure.">CHECK_CUDA(call)</a></code> or after the call has completed with <code>CudaCheckErrors()</code>. MPI calls can be checked using <code><a class="el" href="../../d3/d11/error__handling_8h.html#a0e50f070400a5d0a5c296d2e5fac1ecd" title="Check MPI call and log error message on failure.">CHECK_MPI(call)</a></code>. Both will log information provided by the respective libraries on what went wrong given the error code, file and function where the error appeared. More tailored error messages can be written directly by using the <code>error</code> function that logs to the standard error output file given at startup.</p>
<h2><a class="anchor" id="autotoc_md67"></a>
Usage of Macros</h2>
<p >%% TODO there are probably more reasons, expand.</p>
<p >This code relies heavily on the use of macros. There are three different reasons, why macros are used:</p>
<ul>
<li>C does not allow overloading functions, but the functions look identical independent of the type, so we declare a macro instead of a function. Typical examples are the macros in <code>suN.h</code> that implement operations on elementary site types irrespective of whether they are single or double precision. Therefore, we can use the same macros for example for <code>suN_vector</code> and <code>suN_vector_flt</code>.</li>
<li>Very similar code needs to be implemented many times for different types. This is for example the case when implementing memory, communications or conversion for different field types that only differ in few properties, such as dimension. In this case we write a macro that defines the function. For example, if I wanted to declare the following (useless) function</li>
</ul>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> declare_things(<a class="code hl_struct" href="../../d0/da8/structspinor__field.html">spinor_field</a>* s) {</div>
<div class="line">    suNf_spinor spinor;</div>
<div class="line">}</div>
<div class="ttc" id="astructspinor__field_html"><div class="ttname"><a href="../../d0/da8/structspinor__field.html">spinor_field</a></div><div class="ttdoc">Spinor field array containing SU(N_f) spinors in chosen fermion representation.</div><div class="ttdef"><b>Definition:</b> spinor_field.h:189</div></div>
</div><!-- fragment --><p >for all field types not only for the <code><a class="el" href="../../d0/da8/structspinor__field.html" title="Spinor field array containing SU(N_f) spinors in chosen fermion representation.">spinor_field</a></code>, I could write a macro that takes the field type and the elementary site type and invoke the macro for different types directly after.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define _DECLARE_USELESS_FUNCTION(_field_type, _site_type) \</span></div>
<div class="line"><span class="preprocessor">    void declare_things(_field_type* s) { \</span></div>
<div class="line"><span class="preprocessor">        _site_type* site; \</span></div>
<div class="line"><span class="preprocessor">    }</span></div>
<div class="line"> </div>
<div class="line">_DECLARE_USELESS_FUNCTION(<a class="code hl_struct" href="../../d0/da8/structspinor__field.html">spinor_field</a>, suNf_spinor)</div>
<div class="line">_DECLARE_USELESS_FUNCTION(<a class="code hl_struct" href="../../d2/d0e/structsuNg__field.html">suNg_field</a>, suNg)</div>
<div class="line">_DECLARE_USELESS_FUNCTION(<a class="code hl_struct" href="../../d9/d4a/structsuNf__field.html">suNf_field</a>, suNf)</div>
<div class="ttc" id="astructsuNf__field_html"><div class="ttname"><a href="../../d9/d4a/structsuNf__field.html">suNf_field</a></div><div class="ttdoc">Gauge field in chosen fermion representation.</div><div class="ttdef"><b>Definition:</b> spinor_field.h:153</div></div>
<div class="ttc" id="astructsuNg__field_html"><div class="ttname"><a href="../../d2/d0e/structsuNg__field.html">suNg_field</a></div><div class="ttdoc">Gauge field of SU(N_g) matrices.</div><div class="ttdef"><b>Definition:</b> spinor_field.h:98</div></div>
</div><!-- fragment --><ul>
<li>The code is for example in a performance bottleneck GPU kernel and needs to be unrolled. A good example here are the macros in <code><a class="el" href="../../d9/de8/gpu__geometry_8h_source.html">Geometry/gpu_geometry.h</a></code>, that implement manually unrolled for loops over the components of different elementary site types. This unrolling is crucial to best performance and cannot be avoided, however, unrolling the sometimes over 200 components of the site types directly in the kernels would render the code unmanagable. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
